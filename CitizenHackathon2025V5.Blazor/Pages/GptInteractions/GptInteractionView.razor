@page "/gptinteractionview"
@using CitizenHackathon2025V5.Blazor.Client.Constants
@using CitizenHackathon2025V5.Blazor.Client.DTOs
@inject IJSRuntime js

<span class="fas fa-certificate me-2"></span> Gpt Interactions

<div class="page-list">
    <h3>Gpt Interactions List</h3>
    <div class="list-toolbar">
        <div class="left">
            <input class="input-compact" placeholder="Search..."
                   @bind="_q" @bind:event="oninput" />
            @if (!string.IsNullOrWhiteSpace(_q))
            {
                <span class="badge badge-info">“@_q”</span>
            }
        </div>

        <div class="right">
            <button class="chip @( _onlyRecent ? "active" : null )"
                    @onclick="() => ToggleRecent()">
                Récents
            </button>
        </div>
        <div>
            <NavLink class="chip add-chip" href="/gptinteractioncreate">
                Add
            </NavLink>
        </div>
    </div>
        <div class="table-wrapper draggable-container"
                @ref="ScrollContainerRef"
                @onscroll="HandleScroll"
                style="height: 300px; overflow-y: auto; border: 1px solid #444;">
            <table class="table table-striped table-dark styled-table data-list">
                <thead>
                    <tr>
                        <th class="col-narrow">#</th>
                        <th class="col-narrow">Prompt</th>
                        <th class="col-narrow">Response</th>
                        <th class="col-actions">Actions</th>
                    </tr>
                </thead>
                <tbody>
                    @if (!FilterGpt(visibleGptInteractions).Any())
                    {
                      <tr>
                        <td colspan="99">
                            <div class="empty-state">No GptInteractions available at the moment.</div>
                        </td>
                      </tr>
                    }
                    else
                    {
                        @foreach (var gp in FilterGpt(visibleGptInteractions))
                        {
                        <tr>
                            <td class="col-narrow">@gp.Id</td>                
                            <td class="text-ellipsis" title="@gp.Prompt">@gp.Prompt</td>
                            <td class="text-ellipsis" title="@gp.Response">@gp.Response</td>
                            <td class="col-actions">
                                <button class="btn btn-sm btn-outline-info" @onclick="() => ClickInfo(gp.Id)">Info</button>
                            </td>
                        </tr>
                        }
                    }
                </tbody>
            </table>
        </div>
</div>

@if (SelectedId > 0)
{
  <div class="detail-wrapper">
    <div class="list-toolbar">
      <div class="left"><span class="badge badge-info">Details #@SelectedId</span></div>
      <div class="right">
        <button class="chip" @onclick="() => SelectedId = 0">Fermer</button>
      </div>
    </div>
        <GptInteractionDetail Id="@SelectedId" />
  </div>
}

@if (!FilterGpt(visibleGptInteractions).Any())
{
    <div class="oz-empty">No items for these filters.</div>
}

















































































@* // Copyrigtht (c) 2025 Citizen Hackathon https://github.com/POLLESSI/Citizenhackathon2025V5.Blazor.Client. All rights reserved. *@




