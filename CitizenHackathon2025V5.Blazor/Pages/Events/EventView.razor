@page "/eventview"
@namespace CitizenHackathon2025V5.Blazor.Client.Pages.Events
@using CitizenHackathon2025.Blazor.DTOs
@using CitizenHackathon2025V5.Blazor.Client.Constants
@inherits CitizenHackathon2025V5.Blazor.Client.Pages.Shared.OutZenMapPageBase

<span class="fas fa-certificate me-2"></span> Events

<div class="oz-page oz-page--event">
    <div class="oz-map-shell">
        <div id="@MapId" class="oz-map"></div>
    </div>
</div>

<div class="page-list">
    <div class="list-toolbar">
        <div class="left">
            <input class="input-compact" placeholder="Search..."
                   value="@_q"
                   @oninput="OnSearchInput" />

            @if (!string.IsNullOrWhiteSpace(_q))
            {
                <span class="badge badge-info">“@_q”</span>
            }
        </div>

        <div class="right">
            <button class="chip @(_onlyRecent ? "active" : null)" @onclick="ToggleRecent">Recents</button>
        </div>

        <div>
            <NavLink class="chip add-chip" href="/eventcreate">Add</NavLink>
        </div>
    </div>

    <div class="table-wrapper draggable-container"
         @ref="ScrollContainerRef"
         @onscroll="HandleScroll"
         style="height: 300px; overflow-y: auto; border: 1px solid #444;">
        <table class="table table-striped table-dark styled-table data-list">
            <thead>
                <tr>
                    <th class="col-narrow">Name</th>
                    <th class="col-narrow">Date Event</th>
                    <th class="col-actions">Actions</th>
                </tr>
            </thead>
            <tbody>
                @if (!FilterEvent(visibleEvents).Any())
                {
                    <tr>
                        <td colspan="99">
                            <div class="empty-state">No events available at the moment.</div>
                        </td>
                    </tr>
                }
                else
                {
                    @foreach (var ev in FilterEvent(visibleEvents))
                    {
                        var isHot = BestMatchId == ev.Id;
                        <tr id="@($"event-row-{ev.Id}")" class="@(isHot ? "oz-row-hot" : null)">
                            <td class="text-ellipsis">
                                <button type="button" class="link-like" @onclick="() => FocusEventAsync(ev.Id)">
                                    @ev.Name
                                </button>
                            </td>
                            <td class="text-ellipsis">@ev.DateEvent</td>
                            <td class="col-actions">
                                <NavLink class="btn btn-sm btn-glow ev-chip" href=@($"/eventview?detailId={ev.Id}")>Info</NavLink>
                            </td>
                        </tr>
                    }
                }
            </tbody>
        </table>
    </div>
</div>

<Globe />

@if (DetailId is > 0)
{
    <div class="oz-modal-backdrop" @onclick="CloseDetail"></div>
    <div class="oz-modal">
        <div class="oz-modal-header">
            <span class="badge badge-info">Details #@DetailId</span>
            <button class="chip" @onclick="CloseDetail">Close</button>
        </div>
        <div class="oz-modal-body">
            <EventDetail Id="@DetailId.Value" />
        </div>
    </div>
}















































































@* // Copyrigtht (c) 2025 Citizen Hackathon https://github.com/POLLESSI/Citizenhackathon2025V5.Blazor.Client. All rights reserved. *@




