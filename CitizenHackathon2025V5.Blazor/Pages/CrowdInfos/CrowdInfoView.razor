@page "/crowdinfoview"
@using CitizenHackathon2025.Blazor.DTOs;
@using CitizenHackathon2025V5.Blazor.Client.Utils
@using CitizenHackathon2025V5.Blazor.Client.Enums
@inherits CitizenHackathon2025V5.Blazor.Client.Pages.Shared.OutZenMapPageBase

@inject IJSRuntime js
@implements IAsyncDisposable

<span class="fas fa-certificate me-2"></span> Crowd Infos

<div class="crowd-page">
    <div class="oz-map-shell">
        <div id="@MapId" class="leaflet-host"></div>
    </div>
    @* <div class="list-panel" @ref="ScrollContainerRef" @onscroll="HandleScroll">
        @foreach (var co in visibleCrowdInfos)
        {
            <div class="info-row @GetLevelCss(co.CrowdLevel)" @onclick="@(() => ClickInfo(co.Id))">
                <div class="title">@co.LocationName</div>
                <div class="meta">(@co.Latitude, @co.Longitude) — @co.Timestamp.ToLocalTime().ToString("HH:mm:ss")</div>
                <div class="desc">@InfoDesc(co)</div>
            </div>
        }
    </div> *@
</div>


<div class="page-list">
    <div class="list-toolbar">
        <div class="left">
            <input class="input-compact" placeholder="Search..." @bind="Q" @bind:event="oninput" />
            @if (!string.IsNullOrWhiteSpace(_q))
            {
                <span class="badge badge-info">“@_q”</span>
            }
        </div>

        <div class="right">
            <button class="chip @( _onlyRecent ? "active" : null )"
                    @onclick="() => ToggleRecent()">
                Recent
            </button>
        </div>

        <div>
            <NavLink class="chip add-chip" href="/crowdinfocreate">
                Add
            </NavLink>
        </div>
    </div>

    <div class="table-wrapper draggable-container"
         @ref="ScrollContainerRef"
         @onscroll="HandleScroll"
         style="height:300px; overflow-y:auto; border:1px solid #444;">
        <table class="table table-striped table-dark styled-table data-list">
            <thead>
                <tr>
                    <th>Location Name</th>
                    <th>Level</th>
                    <th></th>
                </tr>
            </thead>
            <tbody>
                @if (!FilterCrowd(_visible).Any())
                {
                    <tr><td colspan="3"><div class="empty-state">No Crowd Informations Available.</div></td></tr>
                }
                else
                {
                    @foreach (var co in FilterCrowd(_visible))
                    {
                        <tr>
                            <td>@co.LocationName</td>
                            <td>
                                <span class="crowd @($"crowd--{co.CrowdLevel}")">@co.CrowdLevel</span>
                            </td>
                            <td>
                                <button class="btn btn-sm info-chip @GetLevelCss(co.CrowdLevel)"
                                        title="@InfoDesc(co)"
                                        @onclick="() => ClickInfo(co.Id)">
                                    Info
                                </button>
                            </td>
                        </tr>
                    }
                }
            </tbody>
        </table>
    </div>
    <div>
        <button @onclick="TestMarkers">Test Markers</button>
    </div>
    <div>
        <button @onclick="TestBoot">Test Boot</button>
    </div>
</div>

<Globe />

@if (SelectedId > 0)
{
    <div class="detail-wrapper">
        <div class="list-toolbar">
            <div class="left"><span class="badge badge-info">Détail #@SelectedId</span></div>
            <div class="right">
                <button class="chip" @onclick="() => SelectedId = 0">Fermer</button>
            </div>
        </div>
        <CrowdInfoDetail Id="@SelectedId" />
    </div>
}

















































































@* // Copyrigtht (c) 2025 Citizen Hackathon https://github.com/POLLESSI/Citizenhackathon2025V5.Blazor.Client. All rights reserved. *@