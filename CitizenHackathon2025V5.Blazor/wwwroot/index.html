<!--wwwroot/index.html-->
<!DOCTYPE html>
<html lang="fr-BE">
<head>
    <meta charset="utf-8" />
    <title>CitizenHackathon 2025 - OutZen</title>

    <!-- Blazor: Load all globalization data -->
    <script>window.BlazorWebAssemblyLoadAllGlobalizationData = true;</script>

    <base href="/" />
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    <meta name="theme-color" content="#000000" />
    <meta http-equiv="Cache-Control" content="no-cache" />
    <meta http-equiv="Pragma" content="no-cache" />

    <!-- Favicon & PWA -->
    <link rel="manifest" href="/manifest.webmanifest" />
    <link rel="icon" type="image/png" href="favicon.png" />
    <link rel="apple-touch-icon" sizes="192x192" href="/icons/icon-192.png" />
    <link rel="apple-touch-icon" sizes="512x512" href="/icons/icon-512.png" />

    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;700&display=swap" rel="stylesheet" />

    <!-- Base Styles -->
    <link href="/css/base/variables.css?v=2" rel="stylesheet" />
    <link href="/css/animations/site-variables.css" rel="stylesheet">
    <link href="/css/animations/animations.css" rel="stylesheet" />
    <link href="/css/animations/pulseColors.css" rel="stylesheet" />
    <link href="/css/animations/visual-elements.css" rel="stylesheet" />

    <!-- Theme -->
    <link href="css/themes/outzen.css" rel="stylesheet" />
    <link href="css/themes/styles.css" rel="stylesheet" />

    <!-- Components -->
    <link href="/css/components/detail-container.css" rel="stylesheet" />
    <link href="/css/components/info.css" rel="stylesheet" />
    <link href="/css/components/map.css" rel="stylesheet" />
    <link href="/css/base/simulator.css" rel="stylesheet">
    <link href="css/components/panels.css" rel="stylesheet" />
    <link href="/css/components/table.css" rel="stylesheet" />
    <link href="/css/components/button.css?v=3" rel="stylesheet" />
    <link href="/css/components/globe.css" rel="stylesheet" />

    <!-- External Styles -->
    <link href="css/external/blazored-toast.css" rel="stylesheet" />
    <link href="https://cdnjs.cloudflare.com/ajax/libs/open-iconic/1.1.1/font/css/open-iconic-bootstrap.min.css" rel="stylesheet" />

    <style>
        .outzen-crowd-marker {
            background: transparent !important;
            border: none !important;
            padding: 0 !important;
        }

            .outzen-crowd-marker > div {
                line-height: 1 !important;
            }
    </style>

    <!-- Preload image based on time -->
    <script>
        (function () {
            const h = new Date().getHours();
            const isNight = (h >= 22 || h < 7);
            const link = document.createElement('link');
            link.rel = 'preload';
            link.as = 'image';
            link.href = isNight ? '/images/earth_texture_night.jpg' : '/images/earth_texture.jpg';
            document.head.appendChild(link);
        })();
    </script>

    <!-- Leaflet & MarkerCluster -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" crossorigin="anonymous">
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" crossorigin="anonymous" defer></script>

    <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.5.3/dist/MarkerCluster.css" crossorigin="anonymous">
    <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.5.3/dist/MarkerCluster.Default.css" crossorigin="anonymous">
    <script src="https://unpkg.com/leaflet.markercluster@1.5.3/dist/leaflet.markercluster.js" crossorigin="anonymous" defer></script>

    <!-- ADD: Diagnostic plugin cluster présent/absent -->
    <script>
        window.addEventListener('load', () => {
            if (!window.L || (!L.MarkerClusterGroup && !L.markerClusterGroup)) {
                console.warn("[OutZen] ⚠️ Leaflet Cluster plugin not detected; clusters disabled.");
            } else {
                console.log("[OutZen] ✅ Leaflet Cluster plugin detected.");
            }
        });
    </script>

    <!-- Chart.js & Three.js (globals) -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js" crossorigin="anonymous"></script>

    <!-- SignalR global -->
    <script src="https://cdn.jsdelivr.net/npm/@microsoft/signalr@8.0.5/dist/browser/signalr.min.js"></script>

    <!-- ADD: Helper global pour Blazor: isOutZenBooted() -->
    <script>
        // True si le boot est fait ET si le pont global OutZenInterop est exposé.
        window.isOutZenBooted = function () {
            try { return !!window.__outzenBootFlag && !!window.OutZenInterop; }
            catch { return false; }
        };
    </script>
</head>
<body>
    <div id="app">
        <div class="loading-screen">
            <h1>OutZen</h1>
            <p>Loading...</p>
        </div>
        <div id="blazor-error-ui">
            An error has occurred.
            <a href="" class="reload">Reload</a>
            <a class="dismiss">×</a>
        </div>
    </div>

    <!-- Hidden Images -->
    <img src="/images/day.jpg?v=2" alt="Day Background" style="display:none;" />
    <img src="/images/night.jpg" alt="Night Background" style="display:none;" />
    <img id="bgImage" alt="Background" style="display:none;" />
    <img src="/images/earth_texture.jpg" alt="Earth Texture" style="display:none;" />

    <!-- === Utility / Visual Modules === -->
    <script type="module" src="/js/app/timeEffects.js"></script>
    <script type="module" src="/js/app/wasmUtils.js"></script>
    <script type="module" src="/js/app/earthRotation.js"></script>
    <script type="module" src="/js/app/ui.effects.js"></script>

    <!-- Minimal interop bridge -->
    <script src="/js/trafficInterop.js" defer></script>
    <script src="/js/vendor/interop.js" defer></script>
    <script src="/js/crowdbar.js" defer></script>

    <!-- Service Worker -->
    <script>
        if ('serviceWorker' in navigator && location.hostname !== "localhost") {
            navigator.serviceWorker.register('/service-worker.published.js')
                .then(reg => console.log("✅ Service Worker registered:", reg.scope))
                .catch(err => console.error("❌ SW registration failed:", err));
        } else {
            console.log("⚠️ Service Worker disabled in development.");
        }
    </script>

    <!-- Background (Day/Night switch) -->
    <script>
        (function () {
            const hour = new Date().getHours();
            const isDay = hour >= 7 && hour < 20;
            const dayImg = document.querySelector('img[src*="day.jpg"]');
            const nightImg = document.querySelector('img[src*="night.jpg"]');
            if (dayImg && nightImg) {
                dayImg.style.display = isDay ? "block" : "none";
                nightImg.style.display = isDay ? "none" : "block";
            }
        })();
    </script>

    <!-- Small helpers for Blazor -->
    <script>
        window.getScrollTop = (el) => el ? el.scrollTop || 0 : 0;
        window.getScrollHeight = (el) => el ? el.scrollHeight || 0 : 0;
        window.getClientHeight = (el) => el ? el.clientHeight || 0 : 0;
        window.checkElementExists = (id) => !!document.getElementById(id);
    </script>

    <!-- === OutZen Core Modules (stable import, no cache-bust) === -->
    <script>
        window.OUTZEN_AUTOBOOT = window.OUTZEN_AUTOBOOT === true; // default off
        window.__importLoopDisabled = window.__importLoopDisabled ?? false;
    </script>

    <!--<script type="module">
        (async () => {
            if (window.__importLoopDisabled) { console.info("[OutZen] import loop disabled (index.html)"); return; }
            try {
                const m = await import('/js/app/leafletOutZen.module.js');
                console.log('OutZen Exports:', Object.keys(m));
                if (window.OUTZEN_AUTOBOOT === true && typeof m.bootOutZen === 'function') {
                    await m.bootOutZen({ mapId: 'leafletMap', enableChart: false });
                    console.log('✅ OutZen auto-booted (index.html)');
                }
            } catch (e) {
                console.error('[OutZen] import failed (index):', e);
            }
        })();
    </script>-->
    <script src="/js/outzen-interop.js" defer></script>

    <!-- === Blazor Boot === -->
    <script src="_framework/blazor.webassembly.js"></script>
</body>
</html>









































































<!--/*// Copyrigtht (c) 2025 Citizen Hackathon https://github.com/POLLESSI/Citizenhackathon2025V5.Blazor.Client. All rights reserved.*/-->